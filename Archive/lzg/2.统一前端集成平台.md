# **多子系统统一前端集成平台 —— 前端框架设计概要**

## 一、总体目标

构建一个**统一入口、灵活可配、体验一致**的前端集成平台（Shell），实现对多个异构业务子系统（如 SCADA、资产、工单、EMS、行业应用等）的无缝整合，满足：

- 用户视角：**“一个系统”**，无感知切换  
- 运维视角：**“零代码配置”**，动态组装页面与功能  
- 开发视角：**“独立演进”**，子应用解耦部署  
- 未来视角：**“多端兼容”**，支持 Web + 移动共享集成逻辑  

---

## 二、核心架构原则

| 原则 | 说明 |
|------|------|
| **Shell 中心化治理** | 菜单、路由、权限、模块启用状态、页面布局均由主站统一控制 |
| **子应用完全解耦** | 子系统作为独立部署的微应用（Remote Micro App），可独立开发、构建、发布 |
| **配置驱动运行时组装** | 所有 UI 组合由后端配置驱动，无需重新编译任何子应用 |
| **权限平台级管理** | 权限声明由子应用提供，授权与校验由平台统一执行 |
| **技术栈收敛（当前）** | 前端统一采用 Angular + Webpack Module Federation 实现微前端集成 |

---

## 三、前端平台必须提供的核心能力

### 1. **统一身份与访问控制**
- 基于 OpenID Connect 的单点登录（SSO）
- 用户权限以 `scopes` 列表形式下发，用于前端路由守卫与细粒度控制

### 2. **动态模块管理**
- 平台根据客户授权动态启用/禁用子应用模块
- 子应用通过远程入口（Remote Entry）独立部署，主站运行时按需加载

### 3. **集中式导航与菜单**
- 菜单结构由后端 `/api/navigation` 接口返回
- 支持跨模块组织、权限过滤、多语言、自定义排序与隐藏

### 4. **运行时页面组装引擎**
- 提供通用 Widget 容器，根据配置动态加载并渲染来自任意子应用的组件
- 支持上下文变量绑定（如 `{{ selectedDeviceId }}`）实现跨组件联动
- SCADA 等组态页面仅作为“容器”，不硬编码外部依赖

### 5. **跨应用交互机制**
- **跳转**：统一路由导航，目标页面由 Shell 动态注册  
- **嵌入**：局部 UI（弹窗、卡片、侧边栏）通过组件暴露机制复用  
- **通信**：通过全局上下文服务或标准化事件总线传递轻量状态  

### 6. **统一用户体验（Unified UX）**
| 能力 | 说明 |
|------|------|
| **统一消息中心** | 所有子系统的通知（报警、工单、告警）集中展示、统一管理 |
| **全局多语言同步** | 切换语言后，所有已加载子应用自动刷新文本 |
| **统一主题与品牌** | 通过 CSS Variables 实现客户/租户级主题定制，子应用自动继承 |
| **一致操作反馈** | 加载状态、成功/错误提示等交互反馈风格统一 |

### 7. **API 契约支撑（前端视角）**
平台后端需提供以下关键接口：
- `/api/user/profile` → 用户信息与权限 scopes  
- `/api/modules` → 已授权子应用列表及远程入口  
- `/api/navigation` → 全局菜单配置  
- `/api/pages/{id}` → 页面布局与 Widget 配置  
- `/api/i18n/{lang}` → 多语言包（按模块按需加载）  
- `/api/theme` → 主题变量（支持多租户）  

---

## 四、关键验证点（PoC / 上线前必验）

| 类别 | 验证场景 |
|------|--------|
| **模块动态性** | 新增行业模块后，主站无需发版即可加载并显示 |
| **配置灵活性** | 修改页面配置（如在 SCADA 中添加能耗图表），实时生效 |
| **权限一致性** | 禁用某模块后，其菜单、路由、嵌入组件均不可见/不可用 |
| **跨应用交互** | SCADA 设备点击 → 自动刷新右侧 Asset/EMS 组件内容 |
| **体验一致性** | 切换语言/主题后，所有子应用 UI 同步更新 |
| **独立部署** | 子应用部署在不同域名，主站仍能安全加载 |
| **降级容错** | 远程模块加载失败时，友好提示而非白屏 |

---

## 五、实现路径简述

1. **主站 Shell**  
   - 唯一入口，负责 SSO、全局状态、路由分发、Widget 渲染  
   - 不含业务逻辑，仅集成与治理  

2. **子应用（微应用）**  
   - 每个子系统构建为独立 Angular 应用  
   - 通过 Module Federation 暴露路由与可复用组件  
   - 仅声明所需权限，不存储授权规则  

3. **配置中心（后端支撑）**  
   - 存储模块元数据、菜单、页面布局  
   - 按用户/租户返回个性化配置，实现“所见即所购”  

4. **运行时引擎**  
   - 主站根据配置动态加载远程模块  
   - 通用容器渲染组件，绑定上下文，处理生命周期  

5. **未来扩展**  
   - 多端共享：API 契约无 UI 依赖，移动端可复用相同集成模型  
   - 跨框架支持：通过 Web Component 封装非 Angular 组件（如 3D 引擎）  

---

## 六、价值总结

> **平台管集成，子应用管功能**  
> - **用户**：获得一致、流畅、无割裂的操作体验  
> - **运维**：通过配置即可定制专属工作台，零代码、零发版  
> - **开发**：子团队专注领域逻辑，无需关心集成细节  
> - **企业**：实现“一套平台，多行业、多客户、多终端”灵活交付  

---

> 📌 **备注**：本设计聚焦前端集成框架，不涉及后端数据模型，但明确要求后端提供标准化 API 契约以支撑前端动态能力。

---  
**文档版本**：v1.0  
**适用阶段**：架构设计、技术选型、PoC 验证、需求对齐 