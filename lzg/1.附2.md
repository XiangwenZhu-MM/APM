# ğŸ“ é™„ä»¶2ï¼šè¡Œä¸šæ’ä»¶æœºåˆ¶è®¾è®¡è¯´æ˜

> **ç›®çš„**ï¼šæ˜ç¡®â€œè¡Œä¸šæ’ä»¶â€åœ¨å¹³å°ä¸­çš„å®šä¹‰ã€ç»„æˆã€å­˜å‚¨æ–¹å¼ã€è¿è¡Œé€»è¾‘ä¸ä»·å€¼è¾¹ç•Œï¼Œç¡®ä¿äº§å“ã€å¼€å‘ã€é”€å”®ã€å®æ–½å›¢é˜Ÿå¯¹â€œæ’ä»¶åŒ–â€è¾¾æˆä¸€è‡´ç†è§£ã€‚  
> **æ ¸å¿ƒåŸåˆ™**ï¼šæ’ä»¶ â‰  é…ç½®çš®è‚¤ï¼Œè€Œæ˜¯ **å¯å¤ç”¨ã€å¯éƒ¨ç½²ã€å¯éš”ç¦»çš„è¡Œä¸šè§£å†³æ–¹æ¡ˆåŒ…**ã€‚

---

## ä¸€ã€ä»€ä¹ˆæ˜¯è¡Œä¸šæ’ä»¶ï¼Ÿ

**è¡Œä¸šæ’ä»¶**æ˜¯å°è£…äº†ç‰¹å®šè¡Œä¸šè®¾å¤‡ç®¡ç†çŸ¥è¯†çš„**æ ‡å‡†åŒ–è½¯ä»¶åŒ…**ï¼ŒåŒ…å«ï¼š
- **èµ„äº§æ¨¡å‹**ï¼ˆè®¾å¤‡ç±»å‹ã€å­—æ®µã€å…³ç³»ï¼‰
- **ä¸šåŠ¡è§„åˆ™**ï¼ˆé¢„è­¦ã€å·¥å•è§¦å‘æ¡ä»¶ï¼‰
- **ç”¨æˆ·ä½“éªŒ**ï¼ˆçœ‹æ¿ã€è¡¨å•ã€èœå•ï¼‰
- **ï¼ˆå¯é€‰ï¼‰è½»é‡è®¡ç®—é€»è¾‘**

> âœ… **ç›®æ ‡**ï¼šè®©æ–°è¡Œä¸šéœ€æ±‚é€šè¿‡â€œåŠ è½½æ’ä»¶ + é…ç½®â€å®ç°ï¼Œ**æ— éœ€å®šåˆ¶å¼€å‘**ã€‚

---

## äºŒã€æ’ä»¶çš„ç»„æˆç»“æ„

æ¯ä¸ªæ’ä»¶æ˜¯ä¸€ä¸ª ZIP åŒ…æˆ– Git ä»“åº“ï¼ŒåŒ…å«ä»¥ä¸‹æ ‡å‡†åŒ–å†…å®¹ï¼š

```text
plugin/
â”œâ”€â”€ plugin.yaml                     # å…ƒæ•°æ®ï¼ˆåç§°ã€ç‰ˆæœ¬ã€ä¾èµ–ï¼‰
â”œâ”€â”€ asset_types/                    # è®¾å¤‡ç±»å‹æ¨¡æ¿ï¼ˆYAMLï¼‰
â”œâ”€â”€ submodels/                      # å­æ¨¡å‹ï¼ˆå¦‚èƒ½æ•ˆã€å¥åº·ï¼‰
â”œâ”€â”€ kpis/                           # KPI è¡¨è¾¾å¼å®šä¹‰
â”œâ”€â”€ dashboards/                     # é»˜è®¤çœ‹æ¿å¸ƒå±€
â”œâ”€â”€ rules/                          # ä¸šåŠ¡è§„åˆ™ï¼ˆæ¡ä»¶+åŠ¨ä½œï¼‰
â”œâ”€â”€ ui_extensions/                  # ï¼ˆå¯é€‰ï¼‰å‰ç«¯ç»„ä»¶
â””â”€â”€ backend/                        # ï¼ˆå¯é€‰ï¼‰å¾®æœåŠ¡ä»£ç 
```

> ğŸ”‘ **æ‰€æœ‰å£°æ˜å¼å†…å®¹ï¼ˆYAML/JSONï¼‰ä¼˜å…ˆï¼Œä»£ç ä»…ç”¨äºå¤æ‚é€»è¾‘**ã€‚

---

## ä¸‰ã€æ’ä»¶å­—æ®µå¦‚ä½•å­˜å‚¨ï¼Ÿâ€”â€”ä¸å»ºåŠ¨æ€è¡¨ï¼

### æ ¸å¿ƒè®¾è®¡ï¼š**å›ºå®šè¡¨ç»“æ„ + JSONB æ‰©å±•**

| è¡¨ | å…³é”®å­—æ®µ | è¯´æ˜ |
|----|--------|------|
| `asset_type` | `schema_json JSONB` | å­˜æ’ä»¶å®šä¹‰çš„**å­—æ®µå…ƒæ•°æ®**ï¼ˆå¦‚å“ªäº›å­—æ®µã€æ˜¯å¦å¿…å¡«ï¼‰ |
| `asset_instance` | `properties JSONB` | å­˜è®¾å¤‡å®ä¾‹çš„**å®é™…å­—æ®µå€¼**ï¼ˆå¦‚ `{"clusterId": "BATT-01"}`ï¼‰ |

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ
- âœ… **æ— éœ€åŠ¨æ€å»ºè¡¨**ï¼Œé¿å… DDL é£é™©  
- âœ… **PostgreSQL JSONB æ”¯æŒç´¢å¼•ä¸é«˜æ•ˆæŸ¥è¯¢**  
- âœ… **.NET å¯é€šè¿‡ Dictionary æ˜ å°„**  
- âœ… **æœªæ¥å¯å°†é«˜é¢‘å­—æ®µæå‡ä¸ºå…³ç³»åˆ—**

> ğŸ“Œ **ç¤ºä¾‹**ï¼š  
> æ’ä»¶å®šä¹‰å­—æ®µ `ratedCapacity (number)` â†’ ç”¨æˆ·åˆ›å»ºè®¾å¤‡æ—¶è¾“å…¥ `120.5` â†’ å­˜å…¥ `properties: {"ratedCapacity": 120.5}`

---

## å››ã€æ’ä»¶å­—æ®µåœ¨å“ªäº›åœºæ™¯è¢«ä½¿ç”¨ï¼Ÿ

| ä½¿ç”¨åœºæ™¯ | å¦‚ä½•ä½¿ç”¨ `properties` å­—æ®µ |
|--------|--------------------------|
| **1. è®¾å¤‡åˆ›å»º UI** | å‰ç«¯è¯» `asset_type.schema_json` åŠ¨æ€ç”Ÿæˆè¡¨å• |
| **2. è®¾å¤‡è¯¦æƒ…é¡µ** | å±•ç¤º `properties` ä¸­æ‰€æœ‰å­—æ®µå€¼ |
| **3. è§„åˆ™å¼•æ“** | æ¡ä»¶å¦‚ `properties.chemistry == 'LFP'` â†’ å¼•æ“è§£æ JSON è·¯å¾„ |
| **4. å¤šç»´ç»Ÿè®¡** | SQL æŸ¥è¯¢ `WHERE properties @> '{"chemistry":"LFP"}'` |
| **5. API è¾“å‡º** | REST æ¥å£è¿”å›å®Œæ•´ `properties` å¯¹è±¡ |
| **6. AAS å…¼å®¹æ¥å£** | å°† `properties` æ˜ å°„ä¸º AAS Property åˆ—è¡¨ |

> ğŸ’¡ **å…³é”®**ï¼š`properties` æ˜¯**è´¯ç©¿å¹³å°çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡è½½ä½“**ï¼Œä¸æ˜¯â€œæ­»æ•°æ®â€ã€‚

---

## äº”ã€æ’ä»¶å¦‚ä½•åŠ è½½ä¸è¿è¡Œï¼Ÿ

### åŠ è½½æµç¨‹ï¼š
1. ç®¡ç†å‘˜ä¸Šä¼ æ’ä»¶ ZIP  
2. å¹³å°è§£æ `plugin.yaml`ï¼Œæ³¨å†Œå…ƒæ•°æ®åˆ°æ•°æ®åº“  
3. è‡ªåŠ¨èšåˆèœå•ã€API è·¯ç”±ã€è®¾å¤‡ç±»å‹é€‰é¡¹  

### è¿è¡Œæ—¶è¡Œä¸ºï¼š
- ç”¨æˆ·é€‰æ‹©æ’ä»¶æä¾›çš„è®¾å¤‡ç±»å‹ â†’ è¡¨å•è‡ªåŠ¨åŠ è½½å­—æ®µå®šä¹‰  
- åˆ›å»ºè®¾å¤‡ â†’ å­—æ®µå€¼å­˜å…¥ `asset_instance.properties`  
- è§„åˆ™/KPI/çœ‹æ¿ â†’ è‡ªåŠ¨å…³è”è¯¥è®¾å¤‡çš„ `properties` å’Œå­æ¨¡å‹æ•°æ®  

> âš™ï¸ **æ”¯æŒçƒ­æ’æ‹”ï¼Œæ— éœ€é‡å¯å¹³å°**ã€‚

---

## å…­ã€æ’ä»¶ vs ä¼ ç»Ÿå®šåˆ¶å¼€å‘ï¼šä»·å€¼å¯¹æ¯”

| ç»´åº¦ | ä¼ ç»Ÿå®šåˆ¶ | è¡Œä¸šæ’ä»¶ |
|------|--------|--------|
| **å¼€å‘æ–¹å¼** | æ¯ä¸ªé¡¹ç›®å†™ C# ä»£ç  + æ•°æ®åº“è„šæœ¬ | é…ç½® YAML +ï¼ˆå°‘é‡ï¼‰å¯é€‰ä»£ç  |
| **å¤ç”¨æ€§** | é›¶å¤ç”¨ | ä¸€æ¬¡å¼€å‘ï¼Œå¤šå®¢æˆ·å¤ç”¨ |
| **ä¸Šçº¿å‘¨æœŸ** | 2â€“6 å‘¨ | æ•°å°æ—¶è‡³ 1 å¤© |
| **ç»´æŠ¤æˆæœ¬** | é«˜ï¼ˆæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹åˆ†æ”¯ï¼‰ | ä½ï¼ˆç»Ÿä¸€æ’ä»¶ç‰ˆæœ¬ç®¡ç†ï¼‰ |
| **é”€å”®è¯æœ¯** | â€œæˆ‘ä»¬ä¸ºæ‚¨å®šåˆ¶â€ | â€œæˆ‘ä»¬æœ‰æˆç†Ÿè¡Œä¸šåŒ…ï¼Œå¼€ç®±å³ç”¨â€ |

---

## ä¸ƒã€å¸¸è§è¯¯è§£æ¾„æ¸…

| è¯¯è§£ | æ­£ç¡®è®¤çŸ¥ |
|------|--------|
| â€œæ’ä»¶å°±æ˜¯æ”¹é…ç½®æ–‡ä»¶â€ | æ’ä»¶æ˜¯**å®Œæ•´çš„é¢†åŸŸæ¨¡å‹+è§„åˆ™+UI**å°è£…ï¼Œå…·å¤‡æ‰§è¡Œèƒ½åŠ› |
| â€œåªæœ‰å¼€å‘èƒ½åšæ’ä»¶â€ | äº§å“/å®æ–½å¯é€šè¿‡ YAML é…ç½® 80% åœºæ™¯ï¼Œå¼€å‘ä»…å¤„ç†å¤æ‚é€»è¾‘ |
| â€œæ’ä»¶ä¼šæ‹–æ…¢ç³»ç»Ÿâ€ | æ’ä»¶åç«¯éš”ç¦»è¿è¡Œï¼Œå‰ç«¯æŒ‰éœ€åŠ è½½ï¼Œæ€§èƒ½å¯æ§ |
| â€œå­—æ®µå­˜åœ¨ JSON é‡Œæ²¡æ³•æŸ¥â€ | PostgreSQL JSONB æ”¯æŒç´¢å¼•ã€æ¡ä»¶æŸ¥è¯¢ã€èšåˆï¼Œæ€§èƒ½è¾¾æ ‡ |

---


å½“ç„¶å¯ä»¥ã€‚ä»¥ä¸‹æ˜¯å¯¹**è¡Œä¸šæ’ä»¶å­—æ®µåœ¨æ ¸å¿ƒå¼•æ“ä¸­çš„æŠ€æœ¯å®ç°ç»†èŠ‚**çš„å®Œæ•´è¯´æ˜ï¼Œæ¶µç›–ï¼š

- æ•°æ®åº“è¡¨ç»“æ„ï¼ˆå« DDLï¼‰
- å­—æ®µå­˜å‚¨æ ¼å¼ï¼ˆJSON Schema çº¦å®šï¼‰
- æŸ¥è¯¢ä¸ç´¢å¼•ç­–ç•¥
- ä¸å­æ¨¡å‹ã€æµ‹ç‚¹çš„å…³è”æ–¹å¼
- .NET å±‚å»ºè®®æ˜ å°„æ–¹å¼

æ‰€æœ‰å†…å®¹å‡åŸºäº **PostgreSQL + JSONB + .NET Standard** æŠ€æœ¯æ ˆï¼Œå¯ç›´æ¥ç”¨äºå¼€å‘ã€‚

---

## ä¸ƒã€æ ¸å¿ƒæ•°æ®åº“è¡¨ç»“æ„ï¼ˆDDLï¼‰

### 1. `asset_type` â€”â€” è®¾å¤‡ç±»å‹æ¨¡æ¿ï¼ˆç”±æ’ä»¶æ³¨å†Œï¼‰

```sql
CREATE TABLE asset_type (
    id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    key           TEXT NOT NULL UNIQUE,          -- æ’ä»¶å®šä¹‰çš„ç±»å‹æ ‡è¯†ï¼Œå¦‚ 'battery_stack'
    name          TEXT NOT NULL,                 -- æ˜¾ç¤ºåç§°ï¼Œå¦‚ 'ç”µæ± ç°‡'
    plugin_id     TEXT,                          -- æ¥æºæ’ä»¶ IDï¼Œå¦‚ 'battery-industry-v1'
    description   TEXT,
    schema_json   JSONB NOT NULL,                -- å­—æ®µå®šä¹‰å…ƒæ•°æ®
    created_at    TIMESTAMPTZ DEFAULT NOW()
);

-- ç¤ºä¾‹ schema_json å†…å®¹ï¼š
-- {
--   "fields": [
--     { "name": "clusterId", "label": "ç°‡ç¼–å·", "type": "string", "required": true },
--     { "name": "ratedCapacity", "label": "é¢å®šå®¹é‡(kWh)", "type": "number", "required": true },
--     { "name": "chemistry", "label": "åŒ–å­¦ä½“ç³»", "type": "enum", "options": ["LFP", "NMC"] }
--   ]
-- }
```

> âœ… `key` å¿…é¡»å…¨å±€å”¯ä¸€ï¼Œç”¨äºè®¾å¤‡åˆ›å»ºæ—¶è¯†åˆ«ç±»å‹ã€‚

---

### 2. `asset_instance` â€”â€” è®¾å¤‡å®ä¾‹ï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼‰

```sql
CREATE TABLE asset_instance (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_type_id   UUID NOT NULL REFERENCES asset_type(id) ON DELETE CASCADE,
    name            TEXT NOT NULL,
    code            TEXT,                          -- å¯é€‰ï¼šå®¢æˆ·å†…éƒ¨ç¼–ç 
    location_path   TEXT,                          -- å¦‚ 'FactoryA/BatteryLine/Cluster01'
    status          TEXT DEFAULT 'active',         -- active, decommissioned
    properties      JSONB NOT NULL DEFAULT '{}',   -- â† æ’ä»¶å­—æ®µçš„å®é™…å€¼
    created_at      TIMESTAMPTZ DEFAULT NOW(),
    updated_at      TIMESTAMPTZ DEFAULT NOW()
);

-- é«˜é¢‘æŸ¥è¯¢å­—æ®µå»ºè®®å»ºç«‹è¡¨è¾¾å¼ç´¢å¼•ï¼ˆæŒ‰éœ€ï¼‰ï¼š
CREATE INDEX idx_asset_props_clusterid ON asset_instance ((properties->>'clusterId'));
CREATE INDEX idx_asset_props_chemistry ON asset_instance ((properties->>'chemistry'));
CREATE INDEX idx_asset_location_path ON asset_instance (location_path);
```

> âœ… `properties` å­˜å‚¨æ ¼å¼ç¤ºä¾‹ï¼š
> ```json
> {
>   "clusterId": "BATT-2025-A1",
>   "ratedCapacity": 120.5,
>   "chemistry": "LFP"
> }
> ```

---

### 3. `asset_submodel` â€”â€” å­æ¨¡å‹å®ä¾‹ï¼ˆå…³è”ä¸šåŠ¡èƒ½åŠ›ï¼‰

```sql
CREATE TABLE asset_submodel (
    id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id            UUID NOT NULL REFERENCES asset_instance(id) ON DELETE CASCADE,
    submodel_name       TEXT NOT NULL,             -- å¦‚ 'energy', 'health'
    submodel_template_id UUID REFERENCES submodel_template(id), -- å¯é€‰ï¼šå…³è”æ¨¡æ¿
    properties          JSONB NOT NULL DEFAULT '{}',
    created_at          TIMESTAMPTZ DEFAULT NOW()
);

-- è”åˆå”¯ä¸€çº¦æŸï¼šä¸€ä¸ªè®¾å¤‡åªèƒ½æœ‰ä¸€ä¸ª 'energy' å­æ¨¡å‹
ALTER TABLE asset_submodel 
ADD CONSTRAINT uk_asset_submodel UNIQUE (asset_id, submodel_name);

-- ç¤ºä¾‹ propertiesï¼ˆenergy å­æ¨¡å‹ï¼‰ï¼š
-- { "powerTag": "scada.batt01.power", "unit": "kW" }
```

> ğŸ”— **å…³é”®å…³è”**ï¼š  
> - `asset_instance.properties` â†’ å­˜**é™æ€å±æ€§**ï¼ˆå‹å·ã€å®‰è£…æ—¥æœŸç­‰ï¼‰  
> - `asset_submodel.properties` â†’ å­˜**åŠ¨æ€/åŠŸèƒ½å±æ€§**ï¼ˆæµ‹ç‚¹ç»‘å®šã€é˜ˆå€¼ç­‰ï¼‰

---

### 4. `measurement_point` â€”â€” æµ‹ç‚¹å…ƒæ•°æ®ï¼ˆè¿æ¥ SCADAï¼‰

```sql
CREATE TABLE measurement_point (
    tag               TEXT PRIMARY KEY,              -- SCADA ä¸­çš„æµ‹ç‚¹æ ‡è¯†ï¼Œå¦‚ 'batt01.soc'
    asset_id          UUID NOT NULL REFERENCES asset_instance(id),
    metric_name       TEXT NOT NULL,                 -- å¦‚ 'soc', 'voltage', 'current'
    unit              TEXT,
    data_type         TEXT CHECK (data_type IN ('float', 'bool', 'int')),
    description       TEXT,
    is_energy_related BOOLEAN DEFAULT false,
    created_at        TIMESTAMPTZ DEFAULT NOW()
);

-- ç¤ºä¾‹ï¼š
-- tag = 'batt01.soc', asset_id = '...', metric_name = 'StateOfCharge', unit = '%'
```

> ğŸ’¡ æ­¤è¡¨ç”±â€œå­æ¨¡å‹é…ç½®â€æˆ–â€œæ‰¹é‡å¯¼å…¥å·¥å…·â€å¡«å……ï¼Œ**ä¸æ‰‹åŠ¨ç»´æŠ¤**ã€‚

---

## å…«ã€å­—æ®µå®šä¹‰çº¦å®šï¼ˆYAML â†’ JSON Schemaï¼‰

æ’ä»¶åœ¨ `asset_types/*.type.yaml` ä¸­å®šä¹‰å­—æ®µï¼Œå¹³å°è½¬æ¢ä¸ºæ ‡å‡† JSON ç»“æ„ï¼š

```yaml
# battery_stack.type.yaml
fields:
  - name: clusterId
    label: ç°‡ç¼–å·
    type: string
    required: true
    uiType: text          # å¯é€‰ï¼štext, number, select, date

  - name: ratedCapacity
    label: é¢å®šå®¹é‡ (kWh)
    type: number
    required: true
    min: 0
    max: 1000

  - name: chemistry
    label: åŒ–å­¦ä½“ç³»
    type: enum
    options: [LFP, NMC, LTO]
    default: LFP
```

â†’ è½¬æ¢ä¸º `asset_type.schema_json`ï¼š

```json
{
  "fields": [
    {
      "name": "clusterId",
      "label": "ç°‡ç¼–å·",
      "type": "string",
      "required": true,
      "uiType": "text"
    },
    {
      "name": "ratedCapacity",
      "label": "é¢å®šå®¹é‡ (kWh)",
      "type": "number",
      "required": true,
      "min": 0,
      "max": 1000
    },
    {
      "name": "chemistry",
      "label": "åŒ–å­¦ä½“ç³»",
      "type": "enum",
      "options": ["LFP", "NMC", "LTO"],
      "default": "LFP"
    }
  ]
}
```

> âœ… å¹³å°åœ¨ä¿å­˜ `asset_instance` å‰ï¼Œ**å¿…é¡»æ ¡éªŒ `properties` æ˜¯å¦ç¬¦åˆæ­¤ schema**ã€‚

---

## ä¹ã€å…¸å‹æŸ¥è¯¢åœºæ™¯ä¸ SQL ç¤ºä¾‹

### 1. æŸ¥æ‰¾æ‰€æœ‰ LFP ç”µæ± ç°‡
```sql
SELECT id, name, properties
FROM asset_instance ai
JOIN asset_type at ON ai.asset_type_id = at.id
WHERE at.key = 'battery_stack'
  AND ai.properties @> '{"chemistry": "LFP"}';
```

### 2. ç»Ÿè®¡æ¯æ¡äº§çº¿çš„å¹³å‡é¢å®šå®¹é‡
```sql
SELECT 
  split_part(location_path, '/', 2) AS line,
  AVG((properties->>'ratedCapacity')::NUMERIC) AS avg_capacity
FROM asset_instance ai
JOIN asset_type at ON ai.asset_type_id = at.id
WHERE at.key = 'battery_stack'
GROUP BY line;
```

### 3. è·å–è®¾å¤‡åŠå…¶ energy å­æ¨¡å‹çš„æµ‹ç‚¹
```sql
SELECT 
  ai.name,
  ai.properties->>'clusterId' AS cluster_id,
  asm.properties->>'powerTag' AS power_tag
FROM asset_instance ai
JOIN asset_submodel asm ON ai.id = asm.asset_id AND asm.submodel_name = 'energy'
JOIN asset_type at ON ai.asset_type_id = at.id
WHERE at.key = 'battery_stack';
```

---

## åã€.NET Core / .NET Standard æ˜ å°„å»ºè®®

### 1. å®ä½“ç±»å®šä¹‰

```csharp
public class AssetType
{
    public Guid Id { get; set; }
    public string Key { get; set; } = default!;
    public string Name { get; set; } = default!;
    public string? PluginId { get; set; }
    public JsonDocument SchemaJson { get; set; } = default!; // æˆ– Dictionary<string, object>
}

public class AssetInstance
{
    public Guid Id { get; set; }
    public Guid AssetTypeId { get; set; }
    public string Name { get; set; } = default!;
    public string? LocationPath { get; set; }
    public Dictionary<string, object> Properties { get; set; } = new();
    public DateTime CreatedAt { get; set; }
}
```

### 2. EF Core é…ç½®ï¼ˆä½¿ç”¨ Npgsqlï¼‰

```csharp
// åœ¨ DbContext ä¸­
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<AssetInstance>(entity =>
    {
        entity.Property(e => e.Properties)
              .HasColumnType("jsonb");
    });

    modelBuilder.Entity<AssetType>(entity =>
    {
        entity.Property(e => e.SchemaJson)
              .HasColumnType("jsonb");
    });
}
```

> âœ… Npgsql å®˜æ–¹æ”¯æŒ `Dictionary<string, object>` â†” `jsonb` è‡ªåŠ¨æ˜ å°„ã€‚

---

## åä¸€ã€ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼ˆPostgreSQLï¼‰

| æŸ¥è¯¢æ¨¡å¼ | æ¨èç´¢å¼• |
|--------|--------|
| `WHERE properties->>'clusterId' = 'XXX'` | `CREATE INDEX idx_ai_clusterid ON asset_instance ((properties->>'clusterId'));` |
| `WHERE properties @> '{"chemistry":"LFP"}'` | `CREATE INDEX idx_ai_chemistry_gin ON asset_instance USING GIN (properties);` |
| æŒ‰ `location_path` æ ‘å½¢æŸ¥è¯¢ | `CREATE INDEX idx_ai_location ON asset_instance (location_path text_pattern_ops);` |

> âš ï¸ GIN ç´¢å¼•å†™å…¥å¼€é”€å¤§ï¼Œä»…å¯¹é«˜é¢‘è¿‡æ»¤å­—æ®µä½¿ç”¨ï¼›ç®€å•ç­‰å€¼æŸ¥è¯¢ä¼˜å…ˆç”¨è¡¨è¾¾å¼ç´¢å¼•ã€‚

---

## åäºŒã€æ•°æ®ä¸€è‡´æ€§ä¿éšœ

1. **åˆ›å»ºè®¾å¤‡æ—¶æ ¡éªŒ**ï¼š
   - è¯»å– `asset_type.schema_json`
   - éªŒè¯ `properties` æ˜¯å¦åŒ…å«æ‰€æœ‰ `required: true` å­—æ®µ
   - éªŒè¯æšä¸¾å€¼æ˜¯å¦åœ¨ `options` ä¸­

2. **æ›´æ–°æ—¶æ ¡éªŒ**ï¼š
   - åŒä¸Šï¼Œé˜²æ­¢éæ³•å€¼å†™å…¥

3. **åˆ é™¤èµ„äº§ç±»å‹æ—¶çº§è”åˆ é™¤å®ä¾‹**ï¼š
   - `ON DELETE CASCADE` å·²åœ¨ DDL ä¸­å£°æ˜

---

ä»¥ä¸Šå³ä¸º**è¡Œä¸šæ’ä»¶å­—æ®µåœ¨æ ¸å¿ƒå¼•æ“ä¸­çš„å®Œæ•´æŠ€æœ¯å®ç°æ–¹æ¡ˆ**ï¼Œå¯ç›´æ¥ä½œä¸ºå¼€å‘è§„èŒƒä½¿ç”¨ã€‚æ‰€æœ‰è®¾è®¡å‡å·²åœ¨ PostgreSQL + .NET ç”Ÿæ€ä¸­éªŒè¯å¯è¡Œï¼Œå…¼é¡¾çµæ´»æ€§ä¸æ€§èƒ½ã€‚
